<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Cuenta - Slushy App</title>
    <link rel="icon" href="/images/Slushylogo.png" type="image/x-icon">
    <link rel="stylesheet" href="/css/usuario-style.css">
    <link rel="stylesheet" href="/css/alertasOMG.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

<!-- CONTENEDOR DE NOTIFICACIONES -->
<div id="notification-container"></div>


<!-- Header -->
<header class="header">
    <div class="container">
        <div class="header-content">
            <div class="logo">
                <img src="/images/Slushylogo.png" alt="Slushy App" class="logo-img">
            </div>

            <nav class="main-nav">

            </nav>

            <div class="header-actions">

                <a href="/logoutSlushy" class="btn btn-primary">Salir</a>
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </div>
</header>


<!-- Mobile Menu -->
<div class="mobile-menu" id="mobileMenu">
    <div class="mobile-menu-content">
        <ul class="nav-list">

        </ul>
    </div>
</div>

<!-- User Header -->
<section class="user-header">
    <div class="container">
        <div class="user-profile">
            <div class="user-avatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="user-info">
                <h1 class="user-name">Cargando nombre...</h1>
                <div class="user-email">Cargando email...</div>
                <div class="user-stats">
                    <div class="user-stat">
                        <div class="user-stat">
                            <div class="user-stat-icon">
                                <i class="fas fa-car"></i>
                            </div>
                            <span id="vehicleCount" th:text="${vehiculos.size()} + ' Vehículos'">0 Vehículos</span>
                        </div>
                    </div>

                    <div class="user-stat">
                        <div class="user-stat-icon">
                            <i class="fas fa-ticket"></i>
                        </div>
                        <span>Miembro Standard</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- User Tabs -->
<div class="container">
    <div class="user-tabs">
        <div class="user-tab active" data-tab="vehicles">
            <i class="fas fa-car"></i>
            <span>Mis Vehículos</span>
        </div>
        <div class="user-tab" data-tab="services">
            <i class="fas fa-history"></i>
            <span>Historial</span>
        </div>
        <div class="user-tab" data-tab="membership">
            <i class="fas fa-star"></i>
            <span>Mi Membresia</span>
        </div>
        <div class="user-tab" data-tab="tracking">
            <i class="fas fa-sync-alt"></i>
            <span>Seguimiento</span>
        </div>
        <div class="user-tab" data-tab="settings">
            <i class="fas fa-cog"></i>
            <span>Configuración</span>
        </div>
    </div>

    <!-- Pestaña Mi Membresía -->
    <div class="tab-content" id="membership-contenti">
        <h2 style="margin-bottom: 1.5rem; font-weight: 600;">Mi Membresía</h2>

        <div class="membership-card">
            <div class="membership-header">
                <h3 class="membership-title">Standard</h3>
                <span class="membership-badge standard">Activa</span>
            </div>
            <div class="membership-content">
                <div class="membership-info">
                    <div class="membership-info-item">
                        <i class="fas fa-percentage"></i>
                        <span>Descuento: 5% en servicios</span>
                    </div>
                    <div class="membership-info-item">
                        <i class="fas fa-history"></i>
                        <span>Historial de servicios</span>
                    </div>
                </div>
            </div>
            <div class="membership-footer">
                <button class="btn btn-primary" id="changeMembesrshipBtn">Cambiar Membresía</button>
            </div>
        </div>
    </div>

    <!-- Pestaña Mi Membresía -->
    <div class="tab-content" id="membership-content">
        <h2 style="margin-bottom: 1.5rem; font-weight: 600;">Mi Membresía</h2>

        <div class="membership-card">
            <div class="membership-header">
                <h3 class="membership-title">Standard</h3>
                <span class="membership-badge standard">Activa</span>
            </div>
            <div class="membership-content">
                <div class="membership-info">
                    <div class="membership-info-item">
                        <i class="fas fa-percentage"></i>
                        <span>Descuento: 5% en servicios</span>
                    </div>
                    <div class="membership-info-item">
                        <i class="fas fa-history"></i>
                        <span>Historial de servicios</span>
                    </div>
                </div>
            </div>
            <div class="membership-footer">
                <button class="btn btn-primary" id="changeMembershipBtn">Cambiar Membresía</button>
            </div>
        </div>
    </div>

    <!-- Modal para Cambiar Membresía -->
    <div class="modal" id="membershipModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Cambiar Membresía</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="membershipForm">
                    <div class="membership-options">
                        <label class="membership-option">
                            <input type="radio" name="membership" value="standard" class="membership-radio">
                            <h4>Estándar <span class="membership-price">Gratis</span></h4>
                            <ul>
                            </ul>
                        </label>
                        <label class="membership-option">
                            <input type="radio" name="membership" value="vip" class="membership-radio" checked>
                            <h4>VIP <span class="membership-price">$9.99/mes</span></h4>
                            <ul>
                                <li><i class="fas fa-check"></i> 20% de descuento</li>
                                <li><i class="fas fa-check"></i> 2 lavados gratis/mes</li>
                                <li><i class="fas fa-check"></i> Prioridad en reservas</li>
                            </ul>
                        </label>
                    </div>
                    <div id="paymentInfo" style="display:block;">
                        <h4>Información de Pago</h4>
                        <div class="form-group">
                            <label>N.º Tarjeta</label>
                            <input type="text" id="card-number" placeholder="1234 5678 9012 3456">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Expiración</label>
                                <input type="text" id="card-expiry" placeholder="MM/AA">
                            </div>
                            <div class="form-group">
                                <label>CVC</label>
                                <input type="text" id="card-cvc" placeholder="123">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline modal-close-btn">Cancelar</button>
                <button class="btn btn-primary" id="confirmMembershipBtn">Confirmar Cambio</button>
            </div>
        </div>
    </div>




    <!-- Tab Content -->
    <div class="tab-content active" id="vehicles-content">
        <h2 style="margin-bottom: 1.5rem; font-weight: 600;">Mis Vehículos</h2>

        <div class="vehicle-grid vehicle-card">
            <th:block th:each="vehiculo : ${vehiculos}">
                <div class="vehicle-card" th:attr="data-id=${vehiculo.id}">
                    <div class="vehicle-header">
                        <h3 class="vehicle-title" th:text="${vehiculo.marca} + ' ' + ${vehiculo.linea}">Marca Línea</h3>
                        <div class="vehicle-actions">
                            <a href="#" class="vehicle-action edit-vehicle-btn"
                               th:attr="data-id=${vehiculo.id},
                                            data-placa=${vehiculo.placa},
                                            data-marca=${vehiculo.marca},
                                            data-linea=${vehiculo.linea},
                                            data-modelo=${vehiculo.modelo},
                                            data-color=${vehiculo.color},
                                            data-tipo=${vehiculo.tipoVehiculo}">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a href="#" class="vehicle-action delete-vehicle-btn" th:attr="data-id=${vehiculo.id}">
                                <i class="fas fa-trash-alt"></i>
                            </a>
                        </div>
                    </div>
                    <div class="vehicle-content">
                        <div class="vehicle-info">
                            <div class="vehicle-info-item">
                                <div class="vehicle-info-icon">
                                    <i class="fas fa-car"></i>
                                </div>
                                <span th:text="${vehiculo.tipoVehiculo}">Tipo</span>
                            </div>
                            <div class="vehicle-info-item">
                                <div class="vehicle-info-icon">
                                    <i class="fas fa-palette"></i>
                                </div>
                                <span th:text="${vehiculo.color}">Color</span>
                            </div>
                            <div class="vehicle-info-item">
                                <div class="vehicle-info-icon">
                                    <i class="fas fa-id-card"></i>
                                </div>
                                <span th:text="${vehiculo.placa}">Placa</span>
                            </div>
                        </div>
                        <button class="btn btn-primary btn-block btn-view-status" th:attr="data-vehicle-id=${vehiculo.id}">Ver Estado Actual</button>
                    </div>
                    <div class="vehicle-footer">
                        <button
                                type="button"
                                class="btn btn-outline reservar"
                                th:attr="data-placa=${vehiculo.placa}">
                            Reservar
                        </button>
                    </div>
                </div>
            </th:block>

            <!-- Tarjeta para agregar nuevo vehículo -->
            <div class="add-vehicle">
                <div class="add-vehicle-icon">
                    <i class="fas fa-plus"></i>
                </div>
                <h3>Agregar Vehículo</h3>
                <p>Registra un nuevo vehículo para facilitar tus reservas</p>
            </div>
        </div>
    </div>

    <div class="tab-content" id="services-content">
        <h2 style="margin-bottom: 1.5rem; font-weight: 600;">Historial de Servicios</h2>

        <div class="service-history">
            <div class="service-history-header">
                <h3 class="service-history-title">Servicios Recientes</h3>
            </div>

            <div class="service-item">
                <div class="service-icon">
                    <i class="fas fa-soap"></i>
                </div>
                <div class="service-details">
                    <div class="service-title">
                        <span>Lavado Premium</span>
                        <span class="service-status" style="background-color: rgba(16, 185, 129, 0.1); color: var(--success);">Completado</span>
                    </div>
                    <div class="service-date">15 Marzo, 2023 - 02:30 PM</div>
                    <div class="service-vehicle">Honda CR-V (SUV) • XYZ-789</div>
                    <div class="service-price">$14.99</div>
                </div>
            </div>

        </div>
    </div>
</div>

<div class="tab-content" id="settings-content">
    <h2 class="settings-main-title">Configuración de Cuenta</h2>
    <div class="settings-card">
        <h3 class="settings-title">Información Personal</h3>

        <form id="settingsFormProfile" class="settings-form">
        <div class="form-group">
                <label for="name">Nombre</label>
                <input type="text" id="name" value="Juan" class="form-input">
            </div>

            <div class="form-group">
                <label for="lastname">Apellido</label>
                <input type="text" id="lastname" value="Pérez" class="form-input">
            </div>

            <div class="form-group">
                <label for="cedula">Cedula</label>
                <input type="text" id="cedula" value="1048495835" class="form-input">
            </div>

            <div class="form-group">
                <label for="phone">Teléfono</label>
                <input type="tel" id="phone" value="3014525463" class="form-input">
            </div>

            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
        </form>
    </div>

    <div class="settings-card">
        <h3 class="settings-title">Seguridad</h3>

        <form id="settingsFormPassword" class="settings-form">
            <div class="form-group">
                <label for="current-password">Contraseña Actual</label>
                <input type="password" id="current-password" class="form-input" placeholder="Ingresa tu contraseña actual">
            </div>

            <div class="form-group">
                <label for="new-password">Nueva Contraseña</label>
                <input type="password" id="new-password" class="form-input" placeholder="Ingresa tu nueva contraseña">
            </div>

            <div class="form-group">
                <label for="confirm-password">Confirmar Nueva Contraseña</label>
                <input type="password" id="confirm-password" class="form-input" placeholder="Confirma tu nueva contraseña">
            </div>

            <button type="submit" class="btn btn-primary">Cambiar Contraseña</button>
        </form>
    </div>


</div>



<!-- Modal para Agregar Vehículo -->
<div class="modal" id="addVehicleModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Agregar Nuevo Vehículo</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <form class="modal-form">
                <div class="form-group">
                    <label for="vehicle-plate" class="modal-label">Placa</label>
                    <input type="text" id="vehicle-plate" class="form-control" placeholder="Ej: ABC123">
                </div>
                <div class="form-group">
                    <label for="vehicle-make" class="modal-label">Marca</label>
                    <input type="text" id="vehicle-make" class="form-control" placeholder="Ej: Toyota">
                </div>
                <div class="form-group">
                    <label for="vehicle-line" class="modal-label">Linea</label>
                    <input type="text" id="vehicle-line" class="form-control" placeholder="Ej: Corolla">
                </div>
                <div class="form-group">
                    <label for="vehicle-model" class="modal-label">Modelo</label>
                    <input type="text" id="vehicle-model" class="form-control" placeholder="Ej: 2025">
                </div>
                <div class="form-group">
                    <label for="vehicle-color" class="modal-label">Color</label>
                    <input type="text" id="vehicle-color" class="form-control" placeholder="Ej: Blanco">
                </div>
                <div class="form-group">
                    <label for="vehicle-type" class="modal-label">Tipo</label>
                    <select id="vehicle-type" class="form-control">
                        <option value="">Seleccione un tipo</option>
                        <option value="AUTOMOVIL">Automovil</option>
                        <option value="CAMIONETA">Camioneta</option>
                        <option value="MOTO">Moto</option>
                    </select>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline modal-close-btn">Cancelar</button>
            <button class="btn btn-primary" id="saveVehicleBtn">Guardar Vehículo</button>
        </div>
    </div>
</div>

<!-- Modal para Confirmar Eliminación de Vehículo -->
<div class="modal" id="deleteVehicleModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Confirmar Eliminación</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <p>¿Estás seguro que deseas eliminar este vehículo? Esta acción no se puede deshacer.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline modal-close-btn">Cancelar</button>
            <button class="btn btn-danger" id="confirmDeleteVehicleBtn">Eliminar Vehículo</button>
        </div>
    </div>
</div>

<!-- Modal para Reservar -->
<div class="modal" id="reserveModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Reservar Servicio</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <form class="modal-form">
                <!-- guardamos la placa en un hidden -->
                <input type="hidden" id="reserve-placa">

                <div class="form-group">
                    <label for="reserve-service" class="modal-label">Servicio</label>
                    <select id="reserve-service" class="form-control">
                        <option value="">Selecciona un servicio</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="reserve-date" class="modal-label">Fecha</label>
                    <input type="date" id="reserve-date" class="form-control">
                </div>

                <div class="form-group">
                    <label for="reserve-time" class="modal-label">Hora</label>
                    <select id="reserve-time" class="form-control">
                        <option value="">Selecciona una hora</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="reserve-notes" class="modal-label">Observaciones</label>
                    <textarea id="reserve-notes" class="form-control"
                              placeholder="Por ejemplo: Por favor revisar tapicería."></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline modal-close-btn">Cancelar</button>
            <button class="btn btn-primary" id="confirmReserveBtn">Confirmar Reserva</button>
        </div>
    </div>
</div>


<!-- Alertas Actualizadas -->



<div class="alert-notification success" id="saveAlert">
    <div class="alert-content">
        <i class="fas fa-check-circle alert-icon"></i>
        <span class="alert-text">Los cambios se guardaron correctamente</span>
    </div>
</div>

<div class="alert-notification success" id="deleteAlert">
    <div class="alert-content">
        <i class="fas fa-trash-alt alert-icon"></i>
        <span class="alert-text">El vehículo se eliminó correctamente</span>
    </div>
</div>

<div class="alert-notification success" id="saveAlertNewVehicle">
    <div class="alert-content">
        <i class="fas fa-check-circle alert-icon"></i>
        <span class="alert-text">Vehículo registrado correctamente</span>
    </div>
</div>

<div class="alert-notification success" id="reserveAlert">
    <div class="alert-content">
        <i class="fas fa-calendar-check alert-icon"></i>
        <span class="alert-text">Reserva confirmada exitosamente</span>
    </div>
</div>

<div class="alert-notification error" id="errorAlert">
    <div class="alert-content">
        <i class="fas fa-exclamation-circle alert-icon"></i>
        <span class="alert-text">Ocurrió un error. Intenta nuevamente.</span>
    </div>
</div>

<!-- Modal para Editar Vehículo -->
<div class="modal" id="editVehicleModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Editar Vehículo</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <form class="modal-form">
                <div class="form-group">
                    <label for="edit-vehicle-plate" class="modal-label">Placa</label>
                    <input type="text" id="edit-vehicle-plate" class="form-control" placeholder="Ej: ABC123">
                </div>
                <div class="form-group">
                    <label for="edit-vehicle-make" class="modal-label">Marca</label>
                    <input type="text" id="edit-vehicle-make" class="form-control" placeholder="Ej: Toyota">
                </div>
                <div class="form-group">
                    <label for="edit-vehicle-line" class="modal-label">Linea</label>
                    <input type="text" id="edit-vehicle-line" class="form-control" placeholder="Ej: Corolla">
                </div>
                <div class="form-group">
                    <label for="edit-vehicle-model" class="modal-label">Modelo</label>
                    <input type="text" id="edit-vehicle-model" class="form-control" placeholder="Ej: 2025">
                </div>
                <div class="form-group">
                    <label for="edit-vehicle-color" class="modal-label">Color</label>
                    <input type="text" id="edit-vehicle-color" class="form-control" placeholder="Ej: Blanco">
                </div>
                <div class="form-group">
                    <label for="edit-vehicle-type" class="modal-label">Tipo</label>
                    <select id="edit-vehicle-type" class="form-control">
                        <option value="">Seleccione un tipo</option>
                        <option value="AUTOMOVIL">Automovil</option>
                        <option value="CAMIONETA">Camioneta</option>
                        <option value="MOTO">Moto</option>
                    </select>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline modal-close-btn">Cancelar</button>
            <button class="btn btn-primary" id="saveEditVehicleBtn">Guardar Cambios</button>
        </div>
    </div>
</div>

<!-- Tab Content - Seguimiento -->
<div class="tab-content" id="tracking-content">
    <div class="container">
        <h2 style="margin-bottom: 1.5rem; font-weight: 600;">Seguimiento de Servicios</h2>

        <div class="tracking-grid">
            <!-- Servicio en progreso -->
            <div class="tracking-card active-service">
                <div class="tracking-header">
                    <h3 class="tracking-title">Lavado Premium</h3>
                    <span class="tracking-status">En Proceso</span>
                </div>
                <div class="tracking-content">
                    <div class="tracking-info">
                        <div class="tracking-info-item">
                            <div class="tracking-info-icon">
                                <i class="fas fa-car"></i>
                            </div>
                            <span>Toyota Corolla (ABC-123)</span>
                        </div>
                        <div class="tracking-info-item">
                            <div class="tracking-info-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <span>Iniciado: 10:30 AM</span>
                        </div>
                    </div>
                    <div class="tracking-progress">
                        <div class="tracking-progress-header">
                            <span>Progreso</span>
                            <span>60%</span>
                        </div>
                        <div class="tracking-progress-bar">
                            <div class="tracking-progress-fill" style="width: 60%;"></div>
                        </div>
                    </div>
                </div>
                <div class="tracking-footer">
                    <button class="btn btn-primary btn-view-details" data-service-id="123">
                        <i class="fas fa-eye"></i> Ver Detalles
                    </button>
                </div>
            </div>

            <!-- Servicio completado recientemente -->
            <div class="tracking-card">
                <div class="tracking-header">
                    <h3 class="tracking-title">Lavado Deluxe</h3>
                    <span class="tracking-status completed">Completado</span>
                </div>
                <div class="tracking-content">
                    <div class="tracking-info">
                        <div class="tracking-info-item">
                            <div class="tracking-info-icon">
                                <i class="fas fa-car"></i>
                            </div>
                            <span>Honda CR-V (XYZ-789)</span>
                        </div>
                        <div class="tracking-info-item">
                            <div class="tracking-info-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <span>Completado: 02/05/2023 - 11:45 AM</span>
                        </div>
                    </div>
                </div>
                <div class="tracking-footer">
                    <button class="btn btn-outline btn-view-details" data-service-id="456">
                        <i class="fas fa-eye"></i> Ver Detalles
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Seguimiento Mejorado -->
<div class="modal" id="trackingModal">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h3>Seguimiento de Servicio</h3>
            <button class="modal-close">&times;</button>
        </div>

        <div class="modal-body">
            <div class="tracking-container">
                <div class="tracking-header">
                    <h4>
                        <i class="fas fa-car" style="color: var(--primary);"></i>
                        Servicio #SL-12345
                    </h4>
                    <p>Toyota Corolla (Sedán) • Lavado Premium</p>
                    <span class="status-badge">En Proceso</span>
                </div>

                <div class="progress-section">
                    <div class="progress-header">
                        <span>Progreso del Servicio</span>
                        <span>60%</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" style="width: 60%;"></div>
                    </div>
                </div>

                <div class="info-cards">
                    <div class="info-card">
                        <div class="info-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="info-text">
                            <p class="info-label">Tiempo Estimado</p>
                            <p class="info-value">15 minutos</p>
                        </div>
                    </div>

                    <div class="info-card">
                        <div class="info-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="info-text">
                            <p class="info-label">Inicio</p>
                            <p class="info-value">10:30 AM</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-footer">
            <button class="btn btn-primary" id="updateStatusBtn">Actualizar Estado</button>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-about">
                <div class="logo">
                    <img src="/images/Slushylogo.png" alt="Slushy App" class="logo-img">
                </div>
                <p class="footer-description">
                    La mejor aplicación para el cuidado de tu vehículo. Reserva citas, monitorea el progreso y disfruta de beneficios exclusivos.
                </p>
            </div>

            <div class="footer-links">
                <h3 class="footer-title">Enlaces Rápidos</h3>
                <ul class="footer-nav">
                    <li><a href="#" class="nav-link">Inicio</a></li>
                    <li><a href="#" class="nav-link">Servicios</a></li>
                    <li><a href="#" class="nav-link">Membresía VIP</a></li>
                    <li><a href="#" class="nav-link">Contacto</a></li>
                </ul>
            </div>

            <div class="footer-newsletter">
                <h3 class="footer-title">Suscríbete</h3>
                <p class="footer-description">
                    Recibe nuestras últimas noticias y promociones exclusivas
                </p>
                <div class="newsletter-form">
                    <input type="email" placeholder="Tu correo electrónico" class="newsletter-input">
                    <button type="submit" class="btn btn-primary">Enviar</button>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">© <span id="currentYear">2023</span> Slushy App. Todos los derechos reservados.</p>
        </div>
    </div>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', () => {
      const tabs     = document.querySelectorAll('.user-tab');
      const contents = document.querySelectorAll('.tab-content');

      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          // 1️⃣ Desactivar todas las pestañas y contenidos
          tabs.forEach(t => t.classList.remove('active'));
          contents.forEach(c => c.classList.remove('active'));

          // 2️⃣ Activar la pestaña clickeada...
          tab.classList.add('active');
          // …y su contenido correspondiente
          const panel = document.getElementById(`${tab.dataset.tab}-content`);
          if (panel) panel.classList.add('active');
        });
      });
    });
</script>


<script>
    document.addEventListener('DOMContentLoaded', () => {
      const modal         = document.getElementById('reserveModal');
      const placaField    = document.getElementById('reserve-placa');
      const dateInput     = document.getElementById('reserve-date');
      const serviceSelect = document.getElementById('reserve-service');
      const timeSelect    = document.getElementById('reserve-time');
      const notesInput    = document.getElementById('reserve-notes');
      const confirmBtn    = document.getElementById('confirmReserveBtn');

      // 1️⃣ Abrir modal y fijar placa
      document.querySelectorAll('.reservar').forEach(btn => {
        btn.addEventListener('click', () => {
          placaField.value = btn.dataset.placa;
          dateInput.value  = '';
          serviceSelect.innerHTML = '<option value="">Selecciona un servicio</option>';
          timeSelect.innerHTML    = '<option value="">Selecciona una hora</option>';
          notesInput.value = '';
          modal.classList.add('active');
        });
      });

      // 2️⃣ Cerrar modal
      modal.querySelectorAll('.modal-close, .modal-close-btn').forEach(x =>
        x.addEventListener('click', () => modal.classList.remove('active'))
      );
      modal.addEventListener('click', e => {
        if (e.target === modal) modal.classList.remove('active');
      });

      // 3️⃣ Al cambiar fecha → cargar servicios disponibles
      dateInput.addEventListener('change', async () => {
        const placa = placaField.value;
        const fecha = dateInput.value;
        if (!placa || !fecha) return;

        try {
          const res = await fetch(
            `/user/reservas/servicios-disponibles?placa=${encodeURIComponent(placa)}&fecha=${fecha}`,
            { credentials: 'include' }
          );
          if (!res.ok) throw new Error(res.statusText);
          const servicios = await res.json();

          serviceSelect.innerHTML = '<option value="">Selecciona un servicio</option>';
          servicios.forEach(s => {
            const precio = Object.values(s.preciosPorTipo)[0];
            serviceSelect.innerHTML += `
              <option value="${s.id}">
                ${s.nombre} – $${precio}
              </option>`;
          });
          timeSelect.innerHTML = '<option value="">Selecciona una hora</option>';
        } catch (err) {
          console.error(err);
          showAlert('errorAlert','No se pudieron cargar los servicios.');
        }
      });

      // 4️⃣ Al seleccionar servicio → cargar franjas horarias
      serviceSelect.addEventListener('change', async () => {
        const servicioId = serviceSelect.value;
        const fecha      = dateInput.value;
        if (!servicioId || !fecha) return;

        try {
          const res   = await fetch(
            `/user/reservas/disponibilidad?servicioId=${servicioId}&fecha=${fecha}`,
            { credentials: 'include' }
          );
          if (!res.ok) throw new Error(res.statusText);
          const slots = await res.json();

          timeSelect.innerHTML = '<option value="">Selecciona una hora</option>';
          slots.forEach(dt => {
            const hhmm = dt.split('T')[1].substr(0,5);
            const [hh,mm] = hhmm.split(':').map(n=>+n);
            const ampm = hh>=12?'PM':'AM';
            const h12  = (hh%12||12).toString().padStart(2,'0');
            timeSelect.innerHTML += `
              <option value="${hhmm}">
                ${h12}:${mm.toString().padStart(2,'0')} ${ampm}
              </option>`;
          });
        } catch (err) {
          console.error(err);
          showAlert('errorAlert','No se pudieron cargar los horarios.');
        }
      });

      // 5️⃣ Confirmar reserva + pago simulado
      confirmBtn.addEventListener('click', async () => {
        const body = {
          placaVehiculo: placaField.value,
          servicioId:    serviceSelect.value,
          fechaInicio:   `${dateInput.value}T${timeSelect.value}:00`,
          observaciones: notesInput.value
        };
        if (!body.placaVehiculo || !body.servicioId || !timeSelect.value) {
          showAlert('errorAlert','Completa todos los campos.');
          return;
        }

        try {
          const res = await fetch('/user/reservas/crear', {
            method: 'POST',
            headers: { 'Content-Type':'application/json' },
            credentials: 'include',
            body: JSON.stringify(body)
          });
          if (!res.ok) throw new Error(await res.text()||res.statusText);
          await res.json();

          modal.classList.remove('active');
          showAlert('reserveAlert','Reserva confirmada exitosamente.');
        } catch (err) {
          console.error(err);
          showAlert('errorAlert', err.message);
        }
      });

      // — Helper de alertas —
      function showAlert(id, msg) {
        const a = document.getElementById(id);
        if (!a) return;
        const t = a.querySelector('.alert-text');
        if (t) t.textContent = msg;
        a.classList.add('show');
        setTimeout(()=>a.classList.remove('show'),3000);
      }
    });
</script>

<script>
    const notifContainer = document.getElementById('notification-container');

    function showNotification(message, type = 'info', duration = 5000) {
      // 1) Crear tarjeta
      const card = document.createElement('div');
      card.className = `notification-card ${type}`;
      card.innerHTML = `
        <button class="close-btn" aria-label="Cerrar">&times;</button>
        <div class="message">${message}</div>
      `;

      // 2) Añadir al DOM
      notifContainer.appendChild(card);

      // 3) Cerrar al hacer clic en cualquier parte de la tarjeta o en la X
      const remover = () => {
        card.removeEventListener('click', remover);
        card.remove();
      };
      card.addEventListener('click', remover);

      // 4) Auto-cerrar después de X ms
      setTimeout(remover, duration);
    }

    // Ejemplo: llamarlo con showNotification('¡Hola mundo!', 'success');
</script>

<script>
    let lastProgress = null;

    async function checkProgress() {
      try {
        const res = await fetch('/user/reservas/enProceso', { credentials: 'include' });
        if (res.status === 204) {
          lastProgress = null;
          return;
        }
        if (!res.ok) throw new Error(res.statusText);
        const reserva = await res.json();
        const progreso = reserva.progreso;

        if (lastProgress !== null && progreso !== lastProgress) {
          showNotification(`Tu servicio ha avanzado al ${progreso}%`, 'info');
        }
        lastProgress = progreso;

        // Actualiza también la barra si quieres…
        const fill = document.querySelector('.tracking-progress-fill');
        const pct  = document.querySelector('.tracking-progress-header span:last-child');
        if (fill && pct) {
          fill.style.width = `${progreso}%`;
          pct.textContent = `${progreso}%`;
        }
      } catch (e) {
        console.error('Error comprobando progreso:', e);
        showNotification('Error al comprobar progreso', 'error');
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      checkProgress();
      setInterval(checkProgress, 10_000);
    });
</script>



<script src="/js/user-dashboard.js"></script>
<script src="/js/delete-vehicle.js"></script>
<script src="/js/settings-usuario.js"></script>
<script src="/js/settings-password.js"></script>
<script src="/js/dashboard-historial.js"></script>


</body>
</html>